<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quant Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

    </script>
    <style>
    output {
        display: block;
        margin-top: 4em;
        font-family: monospace;
        font-size: .8em;
    }
    </style>
</head>
<body>
    <div>
        <canvas id="myChart"></canvas>
    </div>
    <script>
        readTextFile("data/A.csv");

        function readTextFile(file)
        {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function ()
            {
                if(rawFile.readyState === 4)
                {
                    if(rawFile.status === 200 || rawFile.status == 0)
                    {
                        var allText = rawFile.responseText;

                        prices = csvToArray(allText);
                        var dates = new Array();
                        var closes = new Array();
                        for (var i = 0; i < prices.length; i++) {
                            dates.push(prices[i]["Date"]);
                            closes.push(prices[i]["Adj Close"]);
                        }

                        const data = {
                            labels: dates,
                            datasets: [{
                              label: 'My First dataset',
                              backgroundColor: 'rgb(255, 99, 132)',
                              borderColor: 'rgb(255, 99, 132)',
                              data: closes,
                              tension: 0.1
                            }]
                        };

                          const config = {
                            type: 'line',
                            data: data,
                          };

                        const myChart = new Chart(
                            document.getElementById('myChart'),
                            config
                        );
                    }
                }
            }
            rawFile.send(null);
        }

        function csvToArray(str, delimiter = ",") {
          // slice from start of text to the first \n index
          // use split to create an array from string by delimiter
          const headers = str.slice(0, str.indexOf("\n")).split(delimiter);

          // slice from \n index + 1 to the end of the text
          // use split to create an array of each csv value row
          const rows = str.slice(str.indexOf("\n") + 1).split("\n");

          const arr = rows.map(function (row) {
            const values = row.split(delimiter);
            const el = headers.reduce(function (object, header, index) {
              if (header == "Date" || header == "Adj Close") {
                object[header] = values[index];
              }
              return object;
            }, {});
            return el;
          });

          return arr;
        }
    </script>
</body>
</html>